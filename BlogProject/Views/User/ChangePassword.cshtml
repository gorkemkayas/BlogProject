@using BlogProject.Web.ViewModels
@{
    Layout = "_SignInUp";
    ViewData["Title"] = "Change Password";
}

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}

@model PasswordChangeViewModel

@if (TempData["Succeed"] != null)
{
    <div id="successAlert" class="custom-alert alert-success">
        <i class="fa-solid fa-check"></i>
        @TempData["Succeed"]!.ToString()
    </div>
}
else if (TempData["Failed"] != null)
{
    <div id="errorAlert" class="custom-alert alert-danger">
        <i class="fa-solid fa-xmark"></i>  @TempData["Failed"]!.ToString()
    </div>
}

<section class="py-3 py-md-4 py-xl-6 d-flex justify-content-center align-items-center" style="margin-top:10rem">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="mb-4 text-center">
                    <h2 class="display-5 fw-bold text-center yazi-efekti professional-title">Change Your Password<span class="text-danger">.</span></h2>
                    <br />
                    <h5 class="text-center fst-italic m-0 professional-subtitle">Secure your account with a new password.</h5>
                    <br />
                    <p class="text-center m-0"></p>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
                <div class="row gy-3 justify-content-center d-flex flex-column align-items-center">
                    <div class="col-12 col-lg-12">
                        <div class="professional-form-container">
                            <form asp-controller="User" asp-action="ChangePassword" method="post" class="professional-form">
                                <div class="row gy-2 overflow-hidden">
                                    <!-- Validation Summary -->
                                    <div class="col-12">
                                        <div class="text-danger validation-summary" asp-validation-summary="ModelOnly"></div>
                                    </div>

                                    <!-- Old Password -->
                                    <div class="col-12">
                                        <div class="form-floating mb-4 mt-4 professional-input-group">
                                            <input asp-for="OldPassword" class="form-control professional-input" type="password" placeholder=" ">
                                            <label asp-for="OldPassword" class="form-label professional-label"></label>
                                            <button type="button" class="password-toggle" data-target="OldPassword">
                                                <i class="fa-solid fa-eye"></i>
                                            </button>
                                        </div>
                                        <span class="text-danger professional-validation" asp-validation-for="OldPassword"></span>
                                    </div>

                                    <!-- New Password -->
                                    <div class="col-12">
                                        <div class="form-floating mb-4 mt-4 professional-input-group">
                                            <input asp-for="NewPassword" class="form-control professional-input" type="password" placeholder=" ">
                                            <label asp-for="NewPassword" class="form-label professional-label"></label>
                                            <button type="button" class="password-toggle" data-target="NewPassword">
                                                <i class="fa-solid fa-eye"></i>
                                            </button>
                                        </div>
                                        <span class="text-danger professional-validation" asp-validation-for="NewPassword"></span>
                                    </div>

                                    <!-- Confirm Password -->
                                    <div class="col-12">
                                        <div class="form-floating mb-2 professional-input-group">
                                            <input asp-for="ConfirmNewPassword" class="form-control professional-input" type="password" placeholder=" ">
                                            <label asp-for="ConfirmNewPassword" class="form-label professional-label"></label>
                                            <button type="button" class="password-toggle" data-target="ConfirmNewPassword">
                                                <i class="fa-solid fa-eye"></i>
                                            </button>
                                        </div>
                                        <span class="text-danger professional-validation" asp-validation-for="ConfirmNewPassword"></span>
                                    </div>

                                    <!-- Submit Button -->
                                    <div class="col-12">
                                        <div class="d-grid">
                                            <button class="btn btn-lg mt-4 fs-6 professional-submit-btn" type="submit">
                                                Change My Password
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    :root {
        --primary-black: #1a1a1a;
        --secondary-black: #2d2d2d;
        --light-gray: #f8f9fa;
        --border-gray: #e9ecef;
        --text-gray: #6c757d;
        --accent-red: #dc3545;
        --success-green: #198754;
        --pure-white: #ffffff;
    }

    /* Professional Typography */
    .professional-title {
        color: var(--primary-black);
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .professional-subtitle {
        color: var(--text-gray);
        font-weight: 400;
    }

    /* Professional Form Container */
    .professional-form-container {
        background: var(--pure-white);
        border: 1px solid var(--border-gray);
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        padding: 40px;
        transition: all 0.3s ease;
    }

        .professional-form-container:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
        }

    /* Professional Input Styling */
    .professional-input-group {
        position: relative;
    }

    .professional-input {
        border: 1px solid var(--border-gray) !important;
        border-radius: 4px !important;
        background: var(--pure-white);
        color: var(--primary-black);
        font-size: 16px;
        font-weight: 400;
        padding: 16px 50px 16px 16px !important;
        transition: all 0.3s ease;
        height: 58px;
    }

        .professional-input:focus {
            border-color: var(--primary-black) !important;
            box-shadow: 0 0 0 2px rgba(26, 26, 26, 0.1) !important;
            background: var(--pure-white);
        }

            .professional-input:focus + .professional-label,
            .professional-input:not(:placeholder-shown) + .professional-label {
                color: var(--primary-black);
                font-weight: 500;
            }

    .professional-label {
        color: var(--text-gray);
        font-weight: 400;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    /* Password Toggle Button */
    .password-toggle {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-gray);
        cursor: pointer;
        padding: 8px;
        z-index: 10;
        transition: color 0.3s ease;
        border-radius: 4px;
    }

        .password-toggle:hover {
            color: var(--primary-black);
            background: var(--light-gray);
        }

    /* Professional Submit Button */
    .professional-submit-btn {
        background: var(--primary-black) !important;
        border: 1px solid var(--primary-black) !important;
        color: var(--pure-white) !important;
        border-radius: 4px !important;
        font-weight: 600;
        font-size: 16px !important;
        letter-spacing: 0.5px;
        padding: 16px 32px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        height: 58px;
    }

        .professional-submit-btn:hover {
            background: var(--secondary-black) !important;
            border-color: var(--secondary-black) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 26, 26, 0.2);
        }

        .professional-submit-btn:active {
            transform: translateY(0);
        }

    /* Professional Validation Messages */
    .professional-validation {
        font-size: 14px;
        font-weight: 500;
        margin-top: 8px;
        display: block;
    }

    .validation-summary {
        background: rgba(220, 53, 69, 0.05);
        border: 1px solid rgba(220, 53, 69, 0.2);
        border-radius: 4px;
        padding: 12px 16px;
        margin-bottom: 20px;
        font-weight: 500;
    }

    /* Professional Alert System */
    .custom-alert {
        position: fixed;
        top: 24px;
        right: 24px;
        z-index: 1050;
        padding: 16px 20px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 320px;
        max-width: 400px;
        transform: translateX(450px);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        font-size: 15px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        border: 1px solid;
    }

        .custom-alert.show-alert {
            transform: translateX(0);
            opacity: 1;
        }

    .alert-success {
        background-color: var(--pure-white);
        border-color: var(--success-green);
        color: var(--success-green);
    }

    .alert-danger {
        background-color: var(--pure-white);
        border-color: var(--accent-red);
        color: var(--accent-red);
    }

    .custom-alert i {
        font-size: 18px;
        flex-shrink: 0;
    }

    /* Clean Focus States */
    .professional-input:focus,
    .professional-submit-btn:focus {
        outline: none;
    }

    /* Loading State */
    .professional-submit-btn.loading {
        pointer-events: none;
        opacity: 0.8;
    }

        .professional-submit-btn.loading:after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            margin: auto;
            border: 2px solid var(--pure-white);
            border-radius: 50%;
            border-top: 2px solid transparent;
            animation: spin 0.8s linear infinite;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .yazi-efekti {
        display: inline-block; /* veya inline-flex */
        font-size: 32px;
        white-space: nowrap;
        overflow: hidden;
        border-right: 3px solid black;
        width: 0;
        animation: yaz 6s steps(26) infinite;
        animation-fill-mode: forwards;
        /* İmlecin yanıp sönmesi için: */
        caret-color: transparent;
        position: relative;
    }

    .yellowtail-regular {
        font-family: "Yellowtail", cursive;
        font-weight: 400;
        font-style: normal;
    }

    .yazi-efekti::after {
        content: "";
        position: absolute;
        right: 0;
        width: 3px;
        height: 1.2em;
        background: black;
        animation: blink 1s step-start infinite;
    }

    @@keyframes yaz {
        0% {
            width: 0;
        }

        50% {
            width: 22ch; /* yazı tamamlanıyor */
        }

        70% {
            width: 22ch; /* bekleme */
        }

        100% {
            width: 0; /* siliniyor */
        }
    }

    @@keyframes blink {
        0%, 50% {
            opacity: 1;
        }

        51%, 100% {
            opacity: 0;
        }
    }

    }
    /* Responsive Design */
    @@media (max-width: 768px) {
        .professional-form-container {
            padding: 24px;
            margin: 0 16px;
        }

        .custom-alert {
            left: 16px;
            right: 16px;
            min-width: auto;
        }

        .professional-input {
            font-size: 16px; /* Prevent zoom on iOS */
        }
    }

    @@media (max-width: 480px) {
        .professional-form-container {
            padding: 20px;
        }

        .professional-title {
            font-size: 2rem !important;
        }
    }

    /* Print Styles */
    @@media print {
        .custom-alert, .password-toggle {
            display: none !important;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Password toggle functionality
        document.querySelectorAll('.password-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const targetName = this.getAttribute('data-target');
                const input = document.querySelector(`[name="${targetName}"]`);
                const icon = this.querySelector('i');

                if (input && icon) {
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                }
            });
        });

        // Form submission loading state
        const form = document.querySelector('.professional-form');
        const submitBtn = document.querySelector('.professional-submit-btn');

        if (form && submitBtn) {
            form.addEventListener('submit', function() {
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
            });
        }

        // Enhanced input interactions
        document.querySelectorAll('.professional-input').forEach(input => {
            // Add focus class to parent
            input.addEventListener('focus', function() {
                this.closest('.professional-input-group').classList.add('focused');
            });

            input.addEventListener('blur', function() {
                this.closest('.professional-input-group').classList.remove('focused');
            });
        });
    });

    function showAlertSuccess(alertId) {
        const alertBox = document.getElementById(alertId);
        if (alertBox) {
            alertBox.classList.add("show-alert");
            setTimeout(() => {
                alertBox.classList.remove("show-alert");
                setTimeout(() => {
                    window.location.href = '/user/signin';
                }, 300);
            }, 3000);
        }
    }

    function showAlertError(alertId) {
        const alertBox = document.getElementById(alertId);
        if (alertBox) {
            alertBox.classList.add("show-alert");
            setTimeout(() => {
                alertBox.classList.remove("show-alert");
            }, 3000);
        }
    }

    // Auto-show alerts
    if (document.getElementById('successAlert')) {
        showAlertSuccess('successAlert');
    }
    if (document.getElementById('errorAlert')) {
        showAlertError('errorAlert');
    }
</script>